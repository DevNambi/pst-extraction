{
  "settings":{
    "index": { "mapping.allow_type_wrapper": true  },

    "analysis" : {
      "char_filter" : {
        "domain_pattern":{
          "type":"pattern_replace",
          "pattern":".*@",
          "replacement":""
        }
      },
      "analyzer" : {
        "domain_analyzer" : {
          "tokenizer" : "standard",
          "char_filter" : ["domain_pattern"]
        }
      }
    }
  },
  "mappings": {
    "emails": {
      "properties": {
        "body_lang": {
          "type": "string"
        },
        "attachments": {
          "properties": {
            "extension": {
              "type": "string"
            },
            "filename": {
              "index": "not_analyzed",
              "type": "string"
            },
            "content_extracted": {
              "type": "boolean"
            },
            "content_encrypted": {
              "type": "boolean"
            },
            "content_type": {
              "type": "string"
            },
            "guid": {
              "index": "not_analyzed",
              "type": "string"
            },
            "filesize": {
              "type": "long"
            },
            "content": {
              "type": "string"
            },
            "exif": {
              "properties": {
                "alt": {
                  "type": "string"
                },
                "gps": {
                  "properties": {
                    "coord": {
                      "type": "geo_point"
                    },
                    "lonref": {
                      "type": "string"
                    },
                    "altref": {
                      "type": "string"
                    },
                    "alt": {
                      "type": "string"
                    },
                    "latref": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "references": {
          "type": "string"
        },
        "subject": {
          "type": "string"
        },
        "messageid": {
          "type": "string"
        },
        "subject_translated": {
          "type": "string"
        },
        "body": {
          "type": "string"
        },
        "ccs": {
          "copy_to": [
            "addrs"
          ],
          "index": "not_analyzed",
          "type": "string"
        },
        "datetime": {
          "format": "dateOptionalTime",
          "type": "date"
        },
        "starred": {
          "null_value": false,
          "type": "boolean"
        },
        "body_translated": {
          "type": "string"
        },
        "forensic-bcc": {
          "type": "string"
        },
        "tos": {
          "copy_to": [
            "addrs"
          ],
          "index": "not_analyzed",
          "type": "string"
        },
        "categories": {
          "type": "string"
        },
        "id": {
          "index": "not_analyzed",
          "type": "string"
        },
        "senders": {
          "copy_to": [
            "addrs"
          ],
          "index": "not_analyzed",
          "type": "string"
        },
        "bccs": {
          "copy_to": [
            "addrs"
          ],
          "index": "not_analyzed",
          "type": "string"
        },
        "subject_lang": {
          "type": "string"
        },
        "addrs": {
          "index": "not_analyzed",
          "type": "string"
        },
        "ccs_line": {
          "type": "string"
        },
        "originating_locations": {
          "properties": {
            "geo_coord": {
              "type": "geo_point"
            },
            "city": {
              "type": "string"
            }
          }
        },
        "senders_line": {
          "type": "string"
        },
        "inreplyto": {
          "type": "string"
        },
        "phone_numbers": {
          "type": "string"
        },
        "entities": {
          "properties": {
            "original_lang": {
              "type": "string"
            },
            "body_entities_translated": {
              "properties": {
                "entity_location": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_full": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_organization": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_misc": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_all": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_person": {
                  "index": "not_analyzed",
                  "type": "string"
                }
              }
            },
            "body_entities": {
              "properties": {
                "entity_location": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_full": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_organization": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_misc": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_all": {
                  "index": "not_analyzed",
                  "type": "string"
                },
                "entity_person": {
                  "index": "not_analyzed",
                  "type": "string"
                }
              }
            }
          }
        },
        "topic_scores": {
          "properties": {
            "idx_8": {
              "type": "double"
            },
            "idx_9": {
              "type": "double"
            },
            "idx_6": {
              "type": "double"
            },
            "idx_7": {
              "type": "double"
            },
            "idx_4": {
              "type": "double"
            },
            "idx_5": {
              "type": "double"
            },
            "idx_2": {
              "type": "double"
            },
            "idx_3": {
              "type": "double"
            },
            "idx_0": {
              "type": "double"
            },
            "idx_1": {
              "type": "double"
            }
          }
        },
        "bccs_line": {
          "type": "string"
        },
        "communities_count": {
          "type": "long"
        },
        "originating_ips": {
          "type": "string"
        },
        "tos_line": {
          "type": "string"
        },
        "communities": {
          "properties": {
            "community_id": {
              "type": "long"
            },
            "community": {
              "index": "not_analyzed",
              "type": "string"
            }
          }
        }
      }
    },
    "email_address": {
      "properties": {
        "last_received": {
          "format": "dateOptionalTime",
          "type": "date"
        },
        "last_sent": {
          "format": "dateOptionalTime",
          "type": "date"
        },
        "received_count": {
          "type": "long"
        },
        "community": {
          "index": "not_analyzed",
          "type": "string"
        },
        "first_sent": {
          "format": "dateOptionalTime",
          "type": "date"
        },
        "sender_attachments": {
          "include_in_parent": true,
          "type": "nested",
          "properties": {
            "email_id": {
              "type": "string"
            },
            "datetime": {
              "format": "dateOptionalTime",
              "type": "date"
            },
            "extension": {
              "type": "string"
            },
            "filename": {
              "type": "string"
            },
            "content_extracted": {
              "type": "boolean"
            },
            "content_encrypted": {
              "type": "boolean"
            },
            "content_type": {
              "type": "string"
            },
            "guid": {
              "type": "string"
            },
            "filesize": {
              "type": "long"
            },
            "exif": {
              "properties": {
                "alt": {
                  "type": "string"
                },
                "gps": {
                  "properties": {
                    "coord": {
                      "type": "geo_point"
                    },
                    "lonref": {
                      "type": "string"
                    },
                    "altref": {
                      "type": "string"
                    },
                    "alt": {
                      "type": "string"
                    },
                    "latref": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "community_id": {
          "type": "long"
        },
        "recepient": {
          "include_in_parent": true,
          "type": "nested",
          "properties": {
            "email_id": {
              "type": "string"
            },
            "datetime": {
              "format": "dateOptionalTime",
              "type": "date"
            }
          }
        },
        "sender": {
          "include_in_parent": true,
          "type": "nested",
          "properties": {
            "email_id": {
              "index": "not_analyzed",
              "type": "string"
            },
            "datetime": {
              "format": "dateOptionalTime",
              "type": "date"
            }
          }
        },
        "domain": {
          "analyzer": "domain_analyzer",
          "type": "string"
        },
        "attachments_count": {
          "type": "long"
        },
        "addr": {
          "copy_to": [
            "domain"
          ],
          "index": "not_analyzed",
          "type": "string"
        },
        "first_received": {
          "format": "dateOptionalTime",
          "type": "date"
        },
        "idx": {
          "type": "long"
        },
        "sent_count": {
          "type": "long"
        }
      }
    },
    "lda-clustering": {
      "properties": {
        "topic": {
          "properties": {
            "score": {
              "type": "double"
            },
            "term": {
              "type": "string"
            },
            "idx": {
              "type": "long"
            }
          }
        },
        "idx": {
          "type": "long"
        }
      }
    },
    "attachments": {
      "properties": {
        "datetime": {
          "format": "dateOptionalTime",
          "type": "date"
        },
        "extension": {
          "index": "not_analyzed",
          "type": "string"
        },
        "filename": {
          "index": "not_analyzed",
          "type": "string"
        },
        "content_extracted": {
          "type": "boolean"
        },
        "content_encrypted": {
          "type": "boolean"
        },
        "content_type": {
          "type": "string"
        },
        "guid": {
          "index": "not_analyzed",
          "type": "string"
        },
        "id": {
          "index": "not_analyzed",
          "type": "string"
        },
        "contents64": {
          "index": "no",
          "type": "string"
        },
        "content": {
          "type": "string"
        },
        "exif": {
          "properties": {
            "alt": {
              "type": "string"
            },
            "gps": {
              "properties": {
                "coord": {
                  "type": "geo_point"
                },
                "lonref": {
                  "type": "string"
                },
                "altref": {
                  "type": "string"
                },
                "alt": {
                  "type": "string"
                },
                "latref": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  }
}
